<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <!--<script src="js/uploadFile.class.js"></script>-->
</head>
<body>
<img src="" id="headimg" width="100" height="100">
<img src="" id="headimg2" width="100" height="100">
<form id="form1" method="post" action="upload.php" enctype="multipart/form-data" target="ifrUpload">
    <input id="myfile" type="file" name="upload_file1" value="" />
</form>
<form id="form2" method="post" action="upload.php" enctype="multipart/form-data" target="ifrUpload2">
    <input id="myfile2" type="file" name="upload_file1" value="" />
</form>
<iframe style="display:none" width="0" height="0" src="" id="ifr" name="ifrUpload"></iframe>

</iframe>
<iframe style="display:none" width="0" height="0" src="" id="ifr2" name="ifrUpload2"></iframe>

</iframe>
</body>
</html>
<!--https://segmentfault.com/q/1010000007108532-->
<script>
    function  test(formId,fileId,frId,imgId){

        var formObj = document.getElementById(formId);
        var fileObj = document.getElementById(fileId);
        var iframeObj =  document.getElementById(frId);
        var imgObj =  document.getElementById(imgId);
        fileObj.onchange = function () {
            formObj.setAttribute('action','upload.php?r='+Math.random());
            formObj.submit();
        }

        function fn() {
            formObj.reset();
            var data = JSON.parse(iframeObj.contentWindow.document.body.innerHTML);
            alert(data.data['url']);

                imgObj.setAttribute('src',data.data['url']);


        }

        iframeObj.attachEvent ? iframeObj.attachEvent('onload', fun) : iframeObj.onload = fn;

    }

    test('form1','myfile','ifr','headimg');
    test('form2','myfile2','ifr2','headimg2');
//    test('form2','myfile2');


</script>