<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <!--<script src="js/uploadFile.class.js"></script>-->
</head>
<body>
<<<<<<< HEAD
<img src="" id="headimg" width="500" height="500">
<img src="" id="headimg2" width="500" height="500">
=======
<img src="" id="headimg" width="100" height="100">
<img src="" id="headimg2" width="100" height="100">
>>>>>>> 81df25bb793842871cf54ad70f0c0708c045496b
<form id="form1" method="post" action="upload.php" enctype="multipart/form-data" target="ifrUpload">
    <input id="myfile" type="file" name="upload_file1" value="" />
</form>
<form id="form2" method="post" action="upload.php" enctype="multipart/form-data" target="ifrUpload2">
<<<<<<< HEAD
    <input id="myfile2" type="file" name="upload_file" value="">
</form>
=======
    <input id="myfile2" type="file" name="upload_file1" value="" />
</form>
<iframe style="display:none" width="0" height="0" src="" id="ifr" name="ifrUpload"></iframe>
>>>>>>> 81df25bb793842871cf54ad70f0c0708c045496b

</iframe>
<iframe style="display:none" width="0" height="0" src="" id="ifr2" name="ifrUpload2"></iframe>

</iframe>
<iframe width="0" height="0" src="" id="ifr2" name="ifrUpload2">

</iframe>
</body>
</html>
<!--https://segmentfault.com/q/1010000007108532-->
<script>
<<<<<<< HEAD
    //上传一
    var upload = new UploadFile();
    UploadFile.prototype.returnData = function () {
        var acceptData = _uploadThis.iframeObj.contentWindow.document.body.innerHTML;
        alert(acceptData);
//        if (acceptData.data['url']) {
//            _this.imgObj.setAttribute('src', acceptData.data['url']);
//        }
=======
    function  test(formId,fileId,frId,imgId){

        var formObj = document.getElementById(formId);
        var fileObj = document.getElementById(fileId);
        var iframeObj =  document.getElementById(frId);
        var imgObj =  document.getElementById(imgId);
        fileObj.onchange = function () {
            formObj.setAttribute('action','upload.php?r='+Math.random());
            formObj.submit();
        }

        function fn() {
            formObj.reset();
            var data = JSON.parse(iframeObj.contentWindow.document.body.innerHTML);
            alert(data.data['url']);

                imgObj.setAttribute('src',data.data['url']);


        }

        iframeObj.attachEvent ? iframeObj.attachEvent('onload', fun) : iframeObj.onload = fn;

>>>>>>> 81df25bb793842871cf54ad70f0c0708c045496b
    }

    test('form1','myfile','ifr','headimg');
    test('form2','myfile2','ifr2','headimg2');
//    test('form2','myfile2');

    var upload2 = new UploadFile();
    UploadFile.prototype.returnData = function () {
        var acceptData = _uploadThis.iframeObj.contentWindow.document.body.innerHTML;
        alert(acceptData);
//        var acceptData = JSON.parse(_this.iframeObj.contentWindow.document.body.innerHTML);
//        if (acceptData.data['url']) {
//            _this.imgObj.setAttribute('src', acceptData.data['url']);
//        }
    }
    upload2.upload({
        url: 'x.php',//请求的url地址 [required]
        formId: 'form2',//要提交的表单id [required]
        fileId: 'myfile2',//文件上传input对应的id值 [required]
        iframeId: 'ifr2',//新窗口对应的id值 [required]
        target: 'ifrUpload2',//新窗口对应的名称 [required]
        imgId: 'headimg2'
    });



</script>